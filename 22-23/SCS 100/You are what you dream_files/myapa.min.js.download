var timer,_myApaUrl,host,$j=jQuery.noConflict(),disableSessionExpiredPopup=!1,showPopup=!1,showSessionExpiredPopup=!1,expiredTime=30,reminderTime=25,cancelReminder=!1,minutesToRefresh=1,refreshRate=6e4*minutesToRefresh,minutesCounter=0,isHttpsPage="https:"==window.location.protocol,isLogedIn=!1,result=!1,cartCookieName="",cookieValidDays=2e3,elapsedTime=0,elapsedMinutesCounter=0;function documentReady(){_myApaUrl=$j("#HeaderLoginLink a").attr("href").split("/")[0]+"//"+$j("#HeaderLoginLink a").attr("href").split("/")[2],(host=0<$j(".headLogo a").length&&1<$j(".headLogo a").attr("href").length?$j(".headLogo a").attr("href"):window.location.protocol+"//"+window.location.host).startsWith("http")||(host=window.location.protocol+"//"+window.location.host);var e=_myApaUrl.split("//")[1];cartCookieName="cart_"+e.split(".")[0].replace("sso","my")+"_"+e.split(".")[1]+"_"+e.split(".")[2],_myApaUrl=_myApaUrl.replace("http:","https:"),updateLoginLinkOnLoad(),setTimeout(updateLoginLink(),500),setTimeout(updateShoppingCartQuantity,500);e=window.location.href.toLowerCase();-1<e.indexOf("login")||-1<e.indexOf("register")||(timer=setInterval(checkSessionStatus,refreshRate),minutesCounter+=minutesToRefresh)}function updateLoginLinkOnLoad(){-1!==document.cookie.indexOf("APA_NAME=")?($j("#HeaderLogoutLink").show(),$j("#HeaderMyApaLink").show(),$j("#HeaderLoginLink").hide(),isLogedIn=!0,hideLoginBox()):(showLoginBox(),$j("#HeaderLoginLink").show(),$j("#HeaderLogoutLink").hide(),$j("#HeaderMyApaLink").hide(),isLogedIn=!1)}function updateLoginLink(){$j.ajax({url:host+"/idem/IsSessionValid",type:"POST",contentType:"application/json; charset-utf-8",data:JSON.stringify({sessionID:getCookie("ERIGHTS")}),async:!0}).done(function(e){(result="true"==e.toLowerCase())?($j("#HeaderLogoutLink").show(),$j("#HeaderMyApaLink").show(),$j("#HeaderLoginLink").hide(),isLogedIn=!0,hideLoginBox()):(showLoginBox(),$j("#HeaderLoginLink").show(),$j("#HeaderLogoutLink").hide(),$j("#HeaderMyApaLink").hide(),isLogedIn=!1)}).fail(function(){result=!1}),-1!==$j("#HeaderLoginLink a").attr("href").indexOf("apa.org/common_include")&&$j("#HeaderLoginLink a").attr("href",_myApaUrl+"/apasso/idm/apalogin?ERIGHTS_TARGET="+encodeURIComponent(window.parent.location.href))}function checkSessionStatus(){isLogedIn?(reminderTime<=minutesCounter&&!cancelReminder&&showReminder(),expiredTime<=minutesCounter&&(isSessionValid()||(cancelReminder=!0,showExpired()))):clearInterval(timer),minutesCounter+=minutesToRefresh}function showExpired(){$j("#HeaderLoginLink").show(),$j("#HeaderLogoutLink").hide(),$j("#HeaderMyApaLink").hide(),showExpiredModal(),clearInterval(timer),isLogedIn=!1,showLoginBox()}function showReminder(){showReminderModal()}function showExpiredModal(){$j(".ui-dialog-content.ui-widget-content").dialog("close"),$j("<div id='sessionExpiredOverlay'  title='Session Expired'><p>You have been logged out. Do you want to log in again?</p></div>").dialog({dialogClass:"session-reminder-wrapper",resizable:!1,height:"auto",width:400,modal:!0,buttons:{"Log in":function(){$j(this).dialog("close"),window.location=_myApaUrl+"/apasso/idm/apalogin?ERIGHTS_TARGET="+encodeURIComponent(window.parent.location.href)},Close:function(){$j(this).dialog("close")}}})}function showReminderModal(){var e=expiredTime-minutesCounter,e=0<=e?e:"";minutesToRefresh=1,$j(".ui-dialog-content.ui-widget-content").dialog("close"),$j(`
	<div id="sessionReminderOverlay" title="Are you still there?">	
		<p>
			Your session is about to expire! You will be logged out in <b id=timeRemaining>${e}</b> minute(s). If you are logged out, you may lose unsaved information.
			<br/><br/>
			Do you want to stay logged in?
		</p>
	</div>`).dialog({dialogClass:"session-reminder-wrapper",resizable:!1,height:"auto",width:400,modal:!0,buttons:{"Keep me logged in":function(){$j(this).dialog("close"),refreshSession()},"Log out":function(){cancelReminder=!0,$j(this).dialog("close"),window.location.href=$j("#HeaderLogoutLink a").attr("href")}}})}function deleteErightsCookies(){document.cookie="ERIGHTS=; expires=Thu, 01 Jan 1970 00:00:01 GMT; Secure"}function showLoginBox(){$j("#login").removeClass("hidden"),$j("#loggedIn").addClass("hidden")}function hideLoginBox(){$j("#login").addClass("hidden"),$j("#loggedIn").removeClass("hidden")}function getCookie(e){for(var o=e+"=",t=document.cookie.split(";"),i=0;i<t.length;i++){for(var a=t[i];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(o))return a.substring(o.length,a.length)}return null}function setCookie(e,o,t){var i,a="";t&&((i=new Date).setTime(i.getTime()+24*t*60*60*1e3),a="; expires="+i.toUTCString()),document.cookie=e+"="+(o||"")+a+"; path=/;domain=.apa.org; Secure"}function isSessionValid(){return result=!1,$j.ajax({url:host+"/idem/IsSessionValid",type:"POST",contentType:"application/json; charset-utf-8",data:JSON.stringify({sessionID:getCookie("ERIGHTS")}),async:!0,success:function(e){e&&(result="true"==e.toLowerCase())},error:function(e,o){result=!1}}),result}function refreshSession(){$j.ajax({url:host+"/idem/RefreshSession",type:"POST",contentType:"application/json; charset-utf-8",data:JSON.stringify({sessionID:getCookie("ERIGHTS")}),async:!1,success:function(e){1!=e&&"true"!=e.toLowerCase()||(minutesCounter=0)},error:function(e,o){}})}function updateShoppingCartQuantity(){null!=getCookie(cartCookieName)&&""!=getCookie(cartCookieName)&&"null"!=getCookie(cartCookieName)?$j.ajax({url:host+"/idem/GetCartQuantity",type:"POST",contentType:"application/json; charset-utf-8",dataType:"json",data:JSON.stringify({cartGuid:getCookie(cartCookieName)}),async:!0}).done(function(e){""!=e&&"-1"!=e?$j("#CartQuantity").html("("+e+")"):"-1"==e?(document.cookie=cartCookieName+"=;path=/;domain=.apa.org;expires=Thu, 01 Jan 1970 00:00:01 GMT; Secure",$j("#CartQuantity").html("(0)")):$j("#CartQuantity").html("")}).fail(function(){$j("#CartQuantity").html("(0)")}):$j("#CartQuantity").html("(0)")}function getCartGuid(){$j.ajax({url:host+"/idem/GetCartGuid",type:"GET",dataType:"json",success:function(e){e=JSON.parse(e);cartCookieName=e.cookieName,setCookie(e.cookieName,e.guid,cookieValidDays)},error:function(e,o){}})}function getCartList(){$j.ajax({url:host+"/idem/GetCartList",type:"POST",contentType:"application/json; charset-utf-8",dataType:"json",data:JSON.stringify({cartGuid:getCookie(cartCookieName)}),async:!1,success:function(e){JSON.parse(e)}})}function add_product_to_cart(o,t){null==getCookie(cartCookieName)||""==getCookie(cartCookieName)||"null"==getCookie(cartCookieName)?(console.log("getCookie is null"),$j.ajax({url:host+"/idem/GetCartGuid",type:"GET",dataType:"json",success:function(e){e=JSON.parse(e);cartCookieName=e.cookieName,setCookie(e.cookieName,e.guid,cookieValidDays),ajaxAddtoCart(o,t)},error:function(e,o){}})):ajaxAddtoCart(o,t)}function add_pn_product_to_cart(o){null==getCookie(cartCookieName)||""==getCookie(cartCookieName)||"null"==getCookie(cartCookieName)?$j.ajax({url:host+"/idem/GetCartGuid",type:"GET",dataType:"json",success:function(e){e=JSON.parse(e);cartCookieName=e.cookieName,setCookie(e.cookieName,e.guid,cookieValidDays),ajaxAddPNToCart(o)},error:function(e,o){}}):ajaxAddPNToCart(o)}function ajaxAddtoCart(o,t){var e={apaItemNum:o,quantity:t,cartGuid:getCookie(cartCookieName),sessionId:getCookie("ERIGHTS")};try{$j.ajax({type:"POST",url:host+"/idem/addtocart",data:JSON.stringify(e),contentType:"application/json; charset-utf-8",success:function(e){displayCartCallback(e,o,t)},failure:function(e){console.log(e)}})}catch(e){console.log("Error calling jQuery post was : "+e.message)}}function displayCartAddedModal(e,o,t){if(t)i={title:t.name,image:t.imageUrl,itemNo:e,type:"database",quantity:o,cartUrl:$j("#HeaderCart > a").attr("href")+"?cartGuid="+getCookie(cartCookieName)};else try{var i={...JSON.parse($j(`.addToCartData[data-item-no=${e}]`).attr("data-json")),quantity:o,cartUrl:$j("#HeaderCart > a").attr("href")+"?cartGuid="+getCookie(cartCookieName)}}catch(e){console.log(e)}i=`
        <div id="miniCartOverlayMask" class="minicartOverlayMask">
            <div class="minicar-wrapper">
                <div id="addedToCartModal" class="minicart addedToCartModal">
                    <div class="Header">
                        <h2>Added to Cart</h2>
                        <img src="/Content/Images/close-icon.png" class="close-cart-modal" alt="close">
                    </div>
                    <div class="added-product">
                        <figure class="cover">
                            <img src="${i.image}" alt="${i.title}"/>
                        </figure>
                        <div class="info">
                            <h2 class="product-name">${i.title}</h2>                    
                            ${"database"!==i.type?`<p class="quanitity">Quantity Added: <span>${i.quantity}</span></p>`:""}        
                            ${"journal_special_issue"!==i.type&&"database"!==i.type?'<p class="hint">Members may receive discount at checkout.</p>':""}
                        </div>
                    </div>
                    <div class="actions">
                        <a href="#" class="close close-cart-modal btnAction gray">Continue Shopping</a>
                        <a href="${i.cartUrl}" class="view-cart btnAction black">View Cart</a>
                    </div>           
                </div>
            </div>
        </div>
    `;$j("body").append(i).fadeIn("normal"),$j("body").css("overflow","hidden"),$j("#miniCartOverlayMask").fadeIn("normal"),$j("body").on("click",".close-cart-modal",function(){$j("#miniCartOverlayMask").fadeOut("normal",function(){$j("#miniCartOverlayMask").remove(),$j("body").css("overflow","auto")})})}function hideMiniCart(){}function ajaxAddPNToCart(o){var t;switch(o){case"3500001":t={cartGuid:getCookie(cartCookieName),sessionId:getCookie("ERIGHTS"),apaItemNum:o,uid:"",name:"APA PsycInfo Day Pass",description:"24 hr pass to APA PsycInfo",imageUrl:"https://www.apa.org/Content/Images/PsycInfo.png",productUrl:"https://www.apa.org/pubs/databases/access/direct",documentCode:"",onlineFirstPublications:!1};break;case"3700001":t={cartGuid:getCookie(cartCookieName),sessionId:getCookie("ERIGHTS"),apaItemNum:o,uid:"",name:"APA PsycExtra Day Pass",description:"24 hr pass to APA PsycExtra",imageUrl:"https://www.apa.org/Content/Images/PsycExtra.png",productUrl:"https://www.apa.org/pubs/databases/access/direct",documentCode:"",onlineFirstPublications:!1};break;case"4840001":t={cartGuid:getCookie(cartCookieName),sessionId:getCookie("ERIGHTS"),apaItemNum:o,uid:"",name:"Day Pass Combo",description:"24 hr pass to APA PsycExtra and APA PsycInfo",imageUrl:"https://www.apa.org/Content/Images/PsycDBCombo.png",productUrl:"https://www.apa.org/pubs/databases/access/direct",documentCode:"",onlineFirstPublications:!1}}try{$j.ajax({type:"POST",url:host+"/idem/AddPNItemToCart",data:JSON.stringify(t),contentType:"application/json; charset-utf-8",success:function(e){displayCartCallback(e,o,1,t)},failure:function(e){console.log(e)}})}catch(e){console.log("Error calling jQuery post was : "+e.message)}}function displayCartCallback(e,o,t,i){e=JSON.parse(e).status;updateShoppingCartQuantity(),loginUrl=_myApaUrl+"/apasso/idm/apalogin?ERIGHTS_TARGET="+encodeURIComponent(window.parent.location.href),"ITEM_ADDED_TO_CART"==e?displayCartAddedModal(o,t,i):"ITEM_EXIST_IN_CART"==e?($j(".ui-dialog-content.ui-widget-content").dialog("close"),$j("<div   title='Item exists in the cart'><p>Sorry, we can't add this item to your cart.<br>This item may only be purchased in single quantities.<br>You may, however, purchase other similar items.</p></div>").dialog({resizable:!1,height:"auto",width:"auto",modal:!0,buttons:{OK:function(){$j(this).dialog("close")}}})):"USER_NOT_LOGGED_IN_ERROR"==e?($j(".ui-dialog-content.ui-widget-content").dialog("close"),$j("<div   title='Need to login'><p>Membership in APA is required to place this order.<br>Please log in  to your APA account so that we can verify your membership.</p></div>").dialog({resizable:!1,height:"auto",width:"auto",modal:!0,buttons:{Login:function(){$j(this).dialog("close"),window.location=_myApaUrl+"/apasso/idm/apalogin?ERIGHTS_TARGET="+encodeURIComponent(window.parent.location.href)},Cancel:function(){$j(this).dialog("close")}}})):"USER_NOT_AUTHORIZED_ERROR"==e?($j(".ui-dialog-content.ui-widget-content").dialog("close"),$j("<div   title='Not authorized'><p style='font-size: 12px;'>We're Sorry, membership in APA is required to place this order, but your account doesn't appear to be associated with an active membership in APA.<br>If you believe you have received this message in error, please contact the APA Service Center at (800) 374-2721 or (202) 336-5500, Monday through Friday, between the hours of 9:00 a.m. and 6:00 p.m. ET or e-mail <a href='mailto:loginconcern@apa.org'>loginconcern@apa.org</a>.</p></div>").dialog({resizable:!1,height:"auto",width:500,modal:!0,buttons:{OK:function(){$j(this).dialog("close")}}})):"NOT_ENOUGH_INVENTORY"==e?($j(".ui-dialog-content.ui-widget-content").dialog("close"),$j("<div   title='Not enough inventory'><p >Sorry, we do not have the quantity you requested.<br>We are updating your cart with the maximum quantity available.</p></div>").dialog({resizable:!1,height:"auto",width:500,modal:!0,buttons:{OK:function(){$j(this).dialog("close")}}})):"USER_HAS_EXISTING_LICENSE"==e?($j(".ui-dialog-content.ui-widget-content").dialog("close"),$j("<div   title='License exists'><p >Sorry, we can't add this item to your cart.<br>You already have an active license on this product.</p></div>").dialog({resizable:!1,height:"auto",width:400,modal:!0,buttons:{OK:function(){$j(this).dialog("close")}}})):alert(e)}function hideModalOverlay(){$j("#overlay").remove(),$j(".notLoggedInDiv").remove()}$j(window).on("blur focus",function(e){if($j(this).data("prevType")!=e.type)switch(e.type){case"blur":isLogedIn&&(elapsedTime=Date.now(),elapsedMinutesCounter=minutesCounter),console.log("blure");break;case"focus":0<elapsedTime&&isLogedIn&&(duration=Math.floor((Date.now()-elapsedTime)/1e3/60),minutesCounter==elapsedMinutesCounter&&(minutesCounter+=duration),elapsedTime=elapsedMinutesCounter=0),console.log("focus")}$j(this).data("prevType",e.type)}),$j(document).ready(function(){var e;0!=$j("#HeaderLoginLink a").length?documentReady():e=setInterval(function(){0<$j("#HeaderLoginLink a").length&&(console.log("Exists!"),documentReady(),clearInterval(e))},100)});